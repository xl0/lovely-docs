## Building Component Libraries

Use `@sveltejs/package` to build component libraries. Structure: `src/lib` is public-facing, `src/routes` is optional documentation/demo, `package.json` is used for publishing.

The `svelte-package` command generates a `dist` directory containing:
- All files from `src/lib` (Svelte components preprocessed, TypeScript transpiled to JavaScript)
- Auto-generated type definitions (`d.ts` files) for all files

## package.json Configuration

**name** - Package name visible on npmjs.com

**license** - Use `"MIT"` or similar; include a LICENSE file

**files** - Array specifying what npm publishes, typically `["dist"]`. Use `.npmignore` to exclude unnecessary files.

**exports** - Entry points configuration:
```json
{
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "svelte": "./dist/index.js"
    },
    "./Foo.svelte": {
      "types": "./dist/Foo.svelte.d.ts",
      "svelte": "./dist/Foo.svelte"
    }
  }
}
```
The `types` condition points to type definitions, `svelte` condition identifies Svelte component libraries. Consumers import via `import { Something } from 'your-library'` or `import Foo from 'your-library/Foo.svelte'`.

**svelte** - Legacy field for backwards compatibility, should point to root entry point: `"svelte": "./dist/index.js"`

**sideEffects** - Helps bundlers with tree-shaking. Mark CSS files as having side effects for webpack compatibility:
```json
{
  "sideEffects": ["**/*.css", "./dist/sideEffectfulFile.js"]
}
```

## TypeScript Support

Type definitions are auto-generated by default. For non-root exports, TypeScript won't resolve the `types` condition by default. Two solutions:

1. Require consumers to set `"moduleResolution": "bundler"` (TypeScript 5+), `"node16"`, or `"nodenext"` in their tsconfig
2. Use `typesVersions` field to map types:
```json
{
  "exports": {
    "./foo": {
      "types": "./dist/foo.d.ts",
      "svelte": "./dist/foo.js"
    }
  },
  "typesVersions": {
    ">4.0": {
      "foo": ["./dist/foo.d.ts"]
    }
  }
}
```

## Best Practices

- Avoid SvelteKit-specific modules like `$app/environment`; use `esm-env` instead or pass values as props
- Define aliases in `svelte.config.js`, not `vite.config.js` or `tsconfig.json`
- Follow semantic versioning; removing exports or export conditions is a breaking change
- Enable declaration maps with `"declarationMap": true` in tsconfig for source navigation
- Include source files in `files` array for declaration maps to work: `["dist", "src/lib"]`

## svelte-package Command Options

- `-w`/`--watch` - Watch for changes
- `-i`/`--input` - Input directory (default: `src/lib`)
- `-o`/`--output` - Output directory (default: `dist`)
- `-p`/`--preserve-output` - Don't delete output before packaging
- `-t`/`--types` - Generate type definitions (default: `true`)
- `--tsconfig` - Path to tsconfig/jsconfig

## Important Caveats

- All relative imports must be fully specified with file extensions: `import { x } from './something/index.js'`
- TypeScript imports must use `.js` extension, not `.ts`
- Non-Svelte, non-TypeScript files are copied as-is